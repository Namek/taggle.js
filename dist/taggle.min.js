/*!
* @author Sean Coker <sean@seancoker.com>
* @version 1.5.1
* @url http://sean.is/poppin/tags
* @license MIT
* @description Taggle is a dependency-less tagging library
*/
(function(e,t){function n(){if(!(2>arguments.length)){for(var e=arguments[0],t=1,n=arguments.length;n>t;t++){var a=arguments[t];for(var l in a)a.hasOwnProperty(l)&&(e[l]=a[l])}return e}}function a(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)}function l(e,t){var n="a"===e.tagName.toLowerCase()?e.parentNode:e,a=t.elements.indexOf(n);t.elements.splice(a,1),t.values.splice(a,1)}function s(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}function i(e){return e.replace(/^\s+|\s+$/g,"")}function r(t,n){e.attachEvent&&!e.addEventListener?t.innerText=n:t.textContent=n}var o={additionalTagClasses:"",allowDuplicates:!1,duplicateTagClass:"",containerFocusClass:"active",hiddenInputName:"taggles[]",tags:[],allowedTags:[],tabIndex:1,placeholder:"Enter tags...",submitKeys:[],submitOnBlur:!0,onTagAdd:function(){},onTagRemove:function(){}},c=8,u=188,d=9,g=32,p=13,f=function(f,v){function m(){h(),y(),C()}function h(){var t,n,a;K.container.rect=j.getBoundingClientRect(),K.container.style=e.getComputedStyle(j),t=K.container.style,n=parseInt(t["padding-left"]||t.paddingLeft,10),a=parseInt(t["padding-right"]||t.paddingRight,10),K.container.padding=n+a}function y(){var t;if(H.className="taggle_list",P.type="text",P.className="taggle_input",P.tabIndex=D.tabIndex,$.className="taggle_sizer",D.tags.length)for(var n=0,a=D.tags.length;a>n;n++){var l=R(D.tags[n]);H.appendChild(l)}F&&(F.style.opacity=0,F.style["pointer-events"]="none",F.classList.add("taggle_placeholder"),j.appendChild(F),r(F,D.placeholder),D.tags.length||(F.style.opacity=1)),M.appendChild(P),H.appendChild(M),j.appendChild(H),j.appendChild($),t=e.getComputedStyle(P).fontSize,$.style.fontSize=t}function C(){s(j,"click",function(){P.focus()});var e=!1;P.onfocus=function(){e=!0,I()},P.onblur=function(){e=!1,S()},s(j,"mouseover",function(){e||I()}),s(j,"mouseout",function(){e||_()}),s(P,"keydown",A),s(P,"keyup",k)}function L(){var e,t,n,a,l;b(),t=P.getBoundingClientRect(),n=K.container.rect,e=~~n.width,e||(e=~~n.right-~~n.left),a=~~t.left-~~n.left,l=K.container.padding,b(e-a-l)}function T(e){return e?!D.allowDuplicates&&x(e)?!1:D.allowedTags.length&&-1===D.allowedTags.indexOf(e)?!1:!0:!1}function w(e,t){var n,a,l,s="string"==typeof t?t.toLowerCase():i(P.value.toLowerCase());T(s)&&(n=R(s),a=H.querySelectorAll("li"),l=a[a.length-1],H.insertBefore(n,l),D.onTagAdd(e,s),P.value="",b(),L(),I())}function E(t){t=t||e.event;var n=j.querySelectorAll(".taggle"),a=n[n.length-1],l="taggle_hot",s=P.classList.contains("taggle_back");""!==P.value||t.keyCode!==c||s?a.classList.contains(l)&&a.classList.remove(l):a.classList.contains(l)?(P.classList.add("taggle_back"),q(a,t),L(),I()):a.classList.add(l)}function b(e){P.style.width=(e||10)+"px"}function x(e){var t,n=V.values.indexOf(e),a=j.querySelector(".taggle_list");if(D.duplicateTagClass){t=a.querySelectorAll("."+D.duplicateTagClass);for(var l=0,s=t.length;s>l;l++)t[l].classList.remove(D.duplicateTagClass)}return n>-1?(D.duplicateTagClass&&a.childNodes[n].classList.add(D.duplicateTagClass),!0):!1}function N(e){var t=!1;return D.submitKeys.indexOf(e)>-1&&(t=!0),t}function I(){L(),j.classList.contains(D.containerFocusClass)||j.classList.add(D.containerFocusClass),F&&(F.style.opacity=0)}function S(){D.submitOnBlur&&w(null,P.value),P.value="",_()}function _(){b(),j.classList.contains(D.containerFocusClass)&&j.classList.remove(D.containerFocusClass),!V.values.length&&F&&(F.style.opacity=1)}function A(t){t=t||e.event;var n=t.keyCode;return B(),!N(n)||n!==g&&""===P.value?(V.values.length&&E(t),undefined):(O(t),undefined)}function k(t){t=t||e.event,P.classList.remove("taggle_back"),r($,P.value)}function O(t){t=t||e.event,w(t),t.preventDefault?t.preventDefault():t.returnValue=!1}function B(){var e=$.getBoundingClientRect().width,t=K.container.rect.width-K.container.padding,n=parseInt($.style.fontSize,10);e+1.5*n>parseInt(P.style.width,10)&&(P.style.width=t+"px")}function R(e){var n=t.createElement("li"),a=t.createElement("a"),l=t.createElement("input"),s=t.createElement("span");return e=e.toLowerCase(),a.href="javascript:void(0)",a.innerHTML="&times;",a.className="close",a.onclick=q.bind(null,a),r(s,e),s.className="taggle_text",n.className="taggle "+D.additionalTagClasses,l.type="hidden",l.value=e,l.name=D.hiddenInputName,n.appendChild(s),n.appendChild(a),n.appendChild(l),V.values.push(e),V.elements.push(n),n}function q(e,t){var n,a;"li"!==e.tagName.toLowerCase()&&(e=e.parentNode),n=e.querySelector(".taggle_text"),a=n.innerText||n.textContent,e.parentNode.removeChild(e),l(e,V),D.onTagRemove(t,a),I()}var F,z=this,D=n({},o,v),K={container:{rect:null,style:null,padding:null}},j=f,V={values:[],elements:[]},H=t.createElement("ul"),M=t.createElement("li"),P=t.createElement("input"),$=t.createElement("div");D.placeholder&&(F=t.createElement("span")),D.submitKeys.length||(D.submitKeys=[u,d,p,g]),"string"==typeof f&&(j=t.getElementById(f)),z.getTags=function(){return V},z.getTagElements=function(){return V.elements},z.getTagValues=function(){return V.values},z.getInput=function(){return P},z.getContainer=function(){return j},z.add=function(e){var t=a(e);if("string"==typeof e)return w(null,e);if(t)for(var n=0,l=e.length;l>n;n++)"string"==typeof e[n]&&w(null,e[n]);return z},z.remove=function(e,t){for(var n=V.values.length-1,a=!1;n>-1&&(V.values[n]===e&&(a=!0,q(V.elements[n])),!a||t);)n--;return z},z.clear=function(){for(var e=V.values.length-1;e>=0;)q(V.elements[e]),e--;return z},m()};e.Taggle=f})(window,document);